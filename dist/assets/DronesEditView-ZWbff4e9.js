import{r as o,E as j,w as H,o as z,e as v,f as a,j as s,k as J,l as y,t as M,u as r,m as D,x as K,y as Q,F as W,A as X,q as Y,b as d,N as Z,s as ee}from"./main-Cjdx7q60.js";/* empty css                            */import{c as te,a as q,b as f,u as ae,f as le,M as se,I as re,F as g,E as x,e as oe}from"./index.esm-isJXD0Mt.js";import{L as ie}from"./Loader-gPqh9Pz8.js";import{D as S}from"./drone-service-rX4Utn3a.js";import{F as ue}from"./filter-value-service-DxA5ilxP.js";import{M as ne}from"./manufactures-service-TeBxyKtG.js";import{I as ce}from"./image-service-DBf-nwwY.js";import{_ as de}from"./SuccessNotification-CWTHgcNT.js";import{s as me}from"./showNotification-BCRs6ctT.js";import{G as pe}from"./GroupSelect-31pwFiN9.js";import"./api-DS0brFyY.js";import"./group-service-Bk1HCOyh.js";const ve={class:"fixed left-0 top-0 h-screen w-64 bg-gray-800 text-white"},fe={class:"w-screen"},ge={key:0,class:"ml-64 flex-1 p-4 w-full"},be={class:"text-xl font-semibold"},ye={class:"flex flex-col gap-2.5"},xe={class:"space-y-2"},_e={class:"space-y-2 col-span-2"},we={key:0,class:"text-red-500 text-sm"},ke={class:"space-y-2"},Ie={class:"space-y-2"},he={class:"space-y-2"},Ve={class:"margin-top flex flex-col gap-2.5"},Me={class:"space-y-2"},De={class:"space-y-2"},qe={class:"space-y-2"},Se={key:0,class:"space-y-2"},Fe={class:"space-y-2"},He={__name:"DronesEditView",setup(Ee){const F=X(),k=o(F.params.id),t=o({}),c=o([]),E=o([]),b=o();o([]);const _=o([]),m=o([]),w=o(!0);let I=o(!1);o(null);const A=te({title:q().required("Title is required"),description:q().required("Description is required"),price:f().typeError("Price must be a number").required("Price is required"),discount:f().typeError("Discount must be a number").required("Discount is required"),amount:f().typeError("Amount must be a number").required("Amount is required"),manufacturer_id:f().nullable().required("Manufacturer is required"),group_id:f().nullable().required("Category is required")}),{handleSubmit:N,setFieldValue:u}=ae({validationSchema:A,initialValues:{description:""},validateOnMount:!1}),G=async()=>{try{t.value=await S.getDrone(k.value),m.value=t.value.images.map(l=>l.id)||[],t.value.description=t.value.description||"",p.value=t.value.filter_values||[]}catch(l){console.error("Ошибка при загрузке группы:",l)}finally{w.value=!1}},T=async()=>{try{c.value=await ue.getAllValues()}catch(l){console.error("Ошибка при загрузке подкатегорий:",l)}},U=async()=>{try{E.value=await ne.getAllManufactures()}catch(l){console.log(l)}},B=l=>{t.value.manufacturer_id=l},C=l=>{t.value.group_id=l},L=l=>{m.value=l},P=l=>{const e=document.createElement("div");return e.innerHTML=l,e.textContent||e.innerText||""},h=N(async l=>{try{const e={...l,description:P(l.description),images:m.value||[],filter_values:p.value.map(i=>i.id)||[],manufacturer_id:t.value.manufacturer_id,group_id:t.value.group_id,subcategories:j(t.value.subcategories.map(i=>i.id))};await S.updateDrone(k.value,e),await me(I)}catch(e){console.error("Ошибка при сохранении аксессуара:",e),alert("Ошибка при сохранении аксессуара")}}),R=async()=>{try{_.value=await ce.getAllImages(),console.log(_.value)}catch(l){console.log(l)}};H(()=>{var l;if(((l=t.value.filter_values)==null?void 0:l.length)>0){const e=new Set(t.value.filter_values.map(i=>i.value));b.value=[...t.value.filter_values],console.log(b.value),c.value.forEach(i=>{e.has(i.value)||b.value.push(i)})}else b.value=c.value.map(e=>[e.value,e.filter.name]),console.log(c.value)});const p=o([]),$={height:400,menubar:!1,plugins:["link","image","table","lists"],toolbar:"undo redo | formatselect | bold italic | alignleft aligncenter alignright | bullist numlist outdent indent | removeformat"};return z(async()=>{await G(),await T(),await U(),await R(),u("title",t.value.title),u("price",t.value.price),u("discount",t.value.discount),u("description",t.value.description||""),u("amount",t.value.amount),u("manufacturer_id",t.value.manufacturer_id),u("group_id",t.value.group_id),m.value=t.value.images.map(l=>l.id)||[],p.value=t.value.filter_values||[]}),(l,e)=>{const i=Y("RouterLink");return d(),v(W,null,[a("nav",ve,[s(Z)]),a("div",fe,[w.value?(d(),J(ie,{key:0})):y("",!0)]),w.value?y("",!0):(d(),v("div",ge,[a("h2",be,M(t.value.title),1),(d(),v("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4 border p-4 rounded-lg shadow-md",key:t.value.id},[a("div",ye,[a("div",xe,[e[3]||(e[3]=a("label",{class:"block text-gray-700"},"Title",-1)),s(r(g),{name:"title",class:"input-field w-full",type:"text",placeholder:"Name of accessory"}),s(r(x),{name:"title",class:"text-red-500 text-sm"})]),a("div",_e,[e[4]||(e[4]=a("label",{class:"block text-gray-700"},"Description",-1)),s(r(g),{name:"description"},{default:D(({value:n,errorMessage:V,handleChange:O})=>[s(r(oe),{"api-key":"odcydkl28d7x03wgsip6dxzkqtcx5olxt496s6x1nu87870j",init:$,modelValue:n,"onUpdate:modelValue":O},null,8,["modelValue","onUpdate:modelValue"]),V?(d(),v("span",we,M(V),1)):y("",!0)]),_:1})]),a("div",ke,[e[5]||(e[5]=a("label",{class:"block text-gray-700"},"Price",-1)),s(r(g),{name:"price",class:"input-field w-full",type:"number",placeholder:"Price"}),s(r(x),{name:"price",class:"text-red-500 text-sm"})]),a("div",Ie,[e[6]||(e[6]=a("label",{class:"block text-gray-700"},"Discount",-1)),s(r(g),{name:"discount",class:"input-field w-full",type:"number",placeholder:"Discount"}),s(r(x),{name:"discount",class:"text-red-500 text-sm"})]),a("div",he,[e[7]||(e[7]=a("label",{class:"block text-gray-700"},"Image url",-1)),K(a("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>t.value.image_url=n),class:"input-field w-full",type:"text",placeholder:"Image url"},null,512),[[Q,t.value.image_url]])])]),a("div",Ve,[a("div",Me,[e[8]||(e[8]=a("label",{class:"block text-gray-700"},"Amount",-1)),s(r(g),{name:"amount",class:"input-field w-full",type:"number",placeholder:"Amount"}),s(r(x),{name:"amount",class:"text-red-500 text-sm"})]),a("div",De,[e[9]||(e[9]=a("label",{class:"block text-gray-700"},"Manufacturer",-1)),s(le,{selectedManufacturerId:t.value.manufacturer_id,"onUpdate:selectedManufacturerId":B},null,8,["selectedManufacturerId"])]),a("div",qe,[e[10]||(e[10]=a("label",{class:"block text-gray-700"},"Group",-1)),s(pe,{selectedGroupId:t.value.group_id,"onUpdate:selectedGroupId":C},null,8,["selectedGroupId"])]),c.value?(d(),v("div",Se,[e[11]||(e[11]=a("label",{class:"block text-gray-700"},"Filter",-1)),s(se,{options:c.value,modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=n=>p.value=n)},null,8,["options","modelValue"])])):y("",!0),a("div",Fe,[e[12]||(e[12]=a("label",{class:"block text-gray-700"},"Images",-1)),a("div",null,[s(re,{images:_.value,initialImageIds:m.value,"onUpdate:imageIds":L},null,8,["images","initialImageIds"])])])]),a("button",{onClick:e[2]||(e[2]=(...n)=>r(h)&&r(h)(...n)),class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"},"Save "),s(i,{to:{name:"drones"}},{default:D(()=>e[13]||(e[13]=[ee("Back")])),_:1})]))])),s(de,{isVisible:r(I)},null,8,["isVisible"])],64)}}};export{He as default};
